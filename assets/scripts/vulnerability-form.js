/**
 * Vulnerability Report Form Handler
 */

const form = document.getElementById('vulnerability-form')

function handleVulnerabilityFormSubmit (event) {
  event.preventDefault()

  const submitButton = document.getElementById('submit-button')
  const errorMessage = document.getElementById('error-message')
  const errorText = document.getElementById('error-text')
  const successMessage = document.getElementById('success-message')

  errorMessage.classList.add('is-hidden')
  successMessage.classList.add('is-hidden')

  submitButton.disabled = true

  const formData = new FormData(form)

  fetch('/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: new URLSearchParams(formData).toString(),
  })
    .then((res) => {
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`)
      }
      submitButton.disabled = false
      form.classList.add('is-hidden')
      successMessage.classList.remove('is-hidden')
      successMessage.scrollIntoView({ behavior: 'smooth', block: 'start' })
    })
    .catch((error) => {
      console.error('Form submission error:', error)
      errorText.textContent = `Error submitting report. Please try again. ${error.message}`
      errorMessage.classList.remove('is-hidden')
      submitButton.disabled = false
      errorMessage.scrollIntoView({ behavior: 'smooth', block: 'start' })
    })
}

form?.addEventListener('submit', handleVulnerabilityFormSubmit)
